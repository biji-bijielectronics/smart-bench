<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

	<title>Energy Calculator</title>

	<style>
		#submitStartButton {
		    background-color: #008CBA;
		    border: none;
		    color: white;
		    padding: 12px 20px;
		    text-align: center;
		    text-decoration: none;
		    display: inline-block;
		    font-size: 16px;
		}

		#submitStopButton {
		    background-color: #f44336;
		    border: none;
		    color: white;
		    padding: 12px 20px;
		    text-align: center;
		    text-decoration: none;
		    display: inline-block;
		    font-size: 16px;
		}

		#submitResetButton {
		    background-color: gray;
		    border: none;
		    color: white;
		    padding: 12px 20px;
		    text-align: center;
		    text-decoration: none;
		    display: inline-block;
		    font-size: 16px;
		}
	</style>

	<!-- Bootstrap -->
	<link href="static/bootstrap.min.css" rel="stylesheet">
	<!-- endBootstrap -->

	<!-- <script type="text/javascript" src="//code.jquery.com/jquery-2.1.4.min.js"></script> -->
	<!-- <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.5/socket.io.min.js"></script> -->

	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script type="text/javascript" src="static/jquery-2.1.4.min.js"></script>
	<script type="text/javascript" src="static/socket.io.min.js"></script>
	<script type="text/javascript" src="static/canvasjs.min.js"></script> <!-- ЗАСУНЬ в папку в js и поменять path -->
	<script type ="text/javascript" src="static/bootstrap.min.js"></script>


	<script type="text/javascript" charset="utf-8">
		var volt = 0;
		var amp = 0;
		var power = 0;

		$(document).ready(function(){
			namespace = '/test';
			var socket = io.connect('http://' + document.domain + ':' + location.port + namespace);

			socket.on('my response', function(msg) {
				$('#log').html(msg.data);
				console.log(msg.data);
				volt = parseFloat(msg.data, 10);
			});


			// event handler for server sent data
			// the data is displayed in the "Receiving" section of the page
			// handlers for the different forms in the page<tbody align="center" id="log"></tbody>
			// these send data to the server in a variety of ways

			$('form#emit').submit(function(event) {
				socket.emit('my eventc', {data: $('#emit_data').val()});
				return false;
			});
		});

		$(document).ready(function(){
			namespace = '/test';
			var socket = io.connect('http://' + document.domain + ':' + location.port + namespace);

			socket.on('my responsec', function(msgc) {
				$('#logc').html(msgc.data);
				console.log(msgc.data);
				amp = parseFloat(msgc.data, 10);
				power = volt * amp;
				document.getElementById("power").innerHTML = power;
			});


			// event handler for server sent data
			// the data is displayed in the "Receiving" section of the page
			// handlers for the different forms in the page<tbody align="center" id="log"></tbody>
			// these send data to the server in a variety of ways

			$('form#emit').submit(function(event) {
				socket.emit('my eventc', {data: $('#emit_data').val()});
				return false;
			});

		});
	
	window.onload = function() {
		// dataPoints
		var dataPoints1 = [];
		var dataPoints2 = [];
		var dataPoints3 = [];

		var chart = new CanvasJS.Chart("chartContainer",{
			zoomEnabled: true,
			animationEnabled: true,
			animationDuration: 500,
			theme: "theme2",
			toolTip: {
				shared: true
			},
			legend: {
				verticalAlign: "top",
				horizontalAlign: "center",
				fontSize: 14,
				fontWeight: "bold",
				fontFamily: "calibri",
				fontColor: "dimGrey"
			},
			axisY:{
				includeZero: false
			},
			data: [{
				// dataSeries1
				type: "line",
				markerType: "square",
				color: "gold",
				xValueType: "dateTime",
				showInLegend: true,
				name: "Voltage",
				dataPoints: dataPoints1
			},
			{
			// dataSeries2
				type: "line",
				markerType: "square",
				color: "blue",
				xValueType: "dateTime",
				showInLegend: true,
				name: "Current" ,
				dataPoints: dataPoints2
			},
			{
				// dataSeries2
				type: "line",
				markerType: "square",
				color: "red",
				xValueType: "dateTime",
				showInLegend: true,
				name: "Power" ,
				dataPoints: dataPoints3
			}],
			legend:{
				cursor:"pointer",
				itemclick : function(e) {
					e.dataSeries.visible = !(typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible);
					chart.render();
				}
			}
		});

		var updateInterval = 1000;
			// initial value

		var time0 = new Date;

			// starting at 9.30 am

		var updateChart = function (count) {
			count = count || 1;

				// count is number of times loop runs to generate random dataPoints.

			for (var i = 0; i < count; i++) {

					// add interval duration to time
					//time.setTime(startTime.getTime() - time.getTime() + updateInterval);

				time0.setTime(time0.getTime()+ updateInterval);

					// generating random values
					//var deltaY1 = .5 + Math.random() *(-.5-.5);
					//var deltaY2 = .5 + Math.random() *(-.5-.5);

					// adding random value and rounding it to two digits.


					// pushing the new values
				dataPoints1.push({
					x: time0.getTime(),
					y: volt
				});
				dataPoints2.push({
					x: time0.getTime(),
					y: amp
				});
				dataPoints3.push({
					x: time0.getTime(),
					y: power
				});
			}
			// updating legend text with  updated with y Value
			chart.render();
		};

		// generates first set of dataPoints
		// updateChart(0);

		// // update chart after specified interval
		// setInterval(function(){updateChart()}, updateInterval);

		var timeoutId,
			startButton = document.getElementById('submitStartButton'),
			stopButton = document.getElementById('submitStopButton'),
			resetButton = document.getElementById('submitResetButton');

		function startLiveChart() {
			updateChart(0);
			timeoutId = setInterval(function(){updateChart()}, updateInterval);
			startButton.removeEventListener('click', startLiveChart);
			stopButton.addEventListener('click', stopLiveChart);
			resetButton.addEventListener('click', resetLiveChart);
		}

		function stopLiveChart() {
			clearTimeout(timeoutId);
		  	stopButton.removeEventListener('click', stopLiveChart);
		  	startButton.addEventListener('click', startLiveChart);
		  	resetButton.addEventListener('click', resetLiveChart);
		}

		function resetLiveChart() {
			clearTimeout(timeoutId);
			chart.destroy();
		  	resetButton.removeEventListener('click', resetLiveChart);
		  	startButton.addEventListener('click', startLiveChart);
		}    

		startButton.addEventListener('click', startLiveChart);
	}
	</script>
</head>

<body>
<h1 align="center">Energy Calculator</h1>
<!-- <h2>Send:</h2> -->
<!--  <form id="emit" method="POST" action='#'>
     <input type="text" name="emit_data" id="emit_data" placeholder="Message">
     <input type="submit" value="Echo">
 </form> -->
<!-- <form id="disconnect" method="POST" action="#">
    <input type="submit" value="Disconnect">
</form> -->
<div class="container">

	<row>
		<col-xs-12>
			<table align="center", border="5", bordercolor="black" bgcolor="white" width="300" height="50">
				<thead>
				<tr>
					<th>Voltage</th>
					<th>Power (W)</th>
					<th>Current</th>

				</tr>
				</thead>
				<tr>
					<td align="center" id="log"></td>
					<td align="center" id="power"></td>
					<td align="center" id="logc"></td>
				</tr>
			</table>
		</col-xs-12>
	</row>

	<row>
		<col-xs-12>
			<p></p>
				<div align="center">
					<div id="chartContainer" style="height: 300px; width: 85%;">
					</div>
				</div>
		</col-xs-12>
	</row>

	<row>
		<col-xs-12>
			<div align="center">
				<button id="submitStartButton" type="submit" value="Start">Start</button>
				<button id="submitStopButton" type="submit" value="Stop">Stop</button>
				<button id="submitResetButton" type="submit" value="Reset">Reset</button>
			</div>
		</col-xs-12>
	</row>

</div>

</body>
</html>